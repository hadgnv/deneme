<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Okul Veri Yönetimi</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: #f9f9f9; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        button { padding: 8px 15px; background: #3cb371; color: white; border: none; border-radius: 4px; cursor: pointer; }
        input, select { padding: 8px; width: 100%; box-sizing: border-box; }
        .tab { display: none; }
        .tab.active { display: block; }
        .tab-buttons { margin-bottom: 20px; }
        .tab-button { padding: 10px 20px; background: #ddd; border: none; cursor: pointer; }
        .tab-button.active { background: #3cb371; color: white; }
    </style>
</head>
<body>
    <h1>Okul Veri Yönetim Paneli</h1>
    
    <div class="tab-buttons">
        <button class="tab-button active" onclick="openTab('okullar')">Okullar</button>
        <button class="tab-button" onclick="openTab('ogretmenler')">Öğretmenler</button>
        <button class="tab-button" onclick="openTab('ogrenciler')">Öğrenciler</button>
        <button class="tab-button" onclick="openTab('excel')">Excel Yükle</button>
    </div>
    
    <div id="okullar" class="tab active">
        <div class="card">
            <h2>Yeni Okul Ekle</h2>
            <input type="text" id="okulAdi" placeholder="Okul Adı">
            <input type="text" id="okulAdres" placeholder="Adres">
            <input type="text" id="okulTelefon" placeholder="Telefon">
            <button onclick="okulEkle()">Kaydet</button>
        </div>
        <table id="okulListesi">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Okul Adı</th>
                    <th>Adres</th>
                    <th>Telefon</th>
                    <th>İşlem</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div id="ogretmenler" class="tab">
        <!-- Öğretmen yönetimi içeriği -->
    </div>
    
    <div id="ogrenciler" class="tab">
        <!-- Öğrenci yönetimi içeriği -->
    </div>
    
    <div id="excel" class="tab">
        <div class="card">
            <h2>Excel'den Veri Yükle</h2>
            <input type="file" id="excelDosya" accept=".csv, .xlsx">
            <select id="tabloSec">
                <option value="okullar">Okullar</option>
                <option value="ogretmenler">Öğretmenler</option>
                <option value="ogrenciler">Öğrenciler</option>
            </select>
            <button onclick="excelYukle()">Yükle</button>
            <div id="yuklemeDurumu"></div>
        </div>
    </div>

    <script>
        // Supabase bağlantısı
        const supabaseUrl = 'https://djtjlmaagjfsnkoqjoec.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdGpsbWFhZ2pmc25rb3Fqb2VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3ODcwOTIsImV4cCI6MjA2MjM2MzA5Mn0.uzwTPGoISIL_knVKty2ueA1USud785hImmIPcFlEk_w';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
        
        // Tab yönetimi
        function openTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Tab açıldığında verileri yenile
            if(tabId === 'okullar') okullariGetir();
            if(tabId === 'ogretmenler') ogretmenleriGetir();
            if(tabId === 'ogrenciler') ogrencileriGetir();
        }
        
        // Okul işlemleri
        async function okulEkle() {
            console.log("okulEkle çağrıldı");
            const okulAdi = document.getElementById('okulAdi').value;
            const adres = document.getElementById('okulAdres').value;
            const telefon = document.getElementById('okulTelefon').value;
            
            const { data, error } = await supabase
                .from('okullar')
                .insert([{ okul_adi: okulAdi, adres: adres, telefon: telefon }]);
            
            if(error) {
                alert('Hata: ' + error.message);
            } else {
                alert('Okul başarıyla eklendi!');
                okullariGetir();
            }
        }
        
        async function okullariGetir() {
            const { data, error } = await supabase
                .from('okullar')
                .select('*');
            
            if(error) {
                console.error('Hata:', error);
                return;
            }
            
            const tbody = document.querySelector('#okulListesi tbody');
            tbody.innerHTML = '';
            
            data.forEach(okul => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${okul.id}</td>
                    <td>${okul.okul_adi}</td>
                    <td>${okul.adres || ''}</td>
                    <td>${okul.telefon || ''}</td>
                    <td>
                        <button onclick="okulSil('${okul.id}')">Sil</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        async function okulSil(id) {
            if(!confirm('Bu okulu silmek istediğinize emin misiniz?')) return;
            
            const { error } = await supabase
                .from('okullar')
                .delete()
                .eq('id', id);
            
            if(error) {
                alert('Silme hatası: ' + error.message);
            } else {
                okullariGetir();
            }
        }
        
        // Excel yükleme
        async function excelYukle() {
            const fileInput = document.getElementById('excelDosya');
            const tablo = document.getElementById('tabloSec').value;
            
            if(!fileInput.files.length) {
                alert('Lütfen bir dosya seçin!');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                const durumDiv = document.getElementById('yuklemeDurumu');
                durumDiv.innerHTML = 'Veriler işleniyor...';
                
                try {
                    // CSV işleme (basit versiyon)
                    const csvData = e.target.result;
                    const lines = csvData.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    const rows = [];
                    
                    for(let i = 1; i < lines.length; i++) {
                        if(!lines[i].trim()) continue;
                        const values = lines[i].split(',');
                        const row = {};
                        headers.forEach((header, j) => {
                            row[header] = values[j] ? values[j].trim() : '';
                        });
                        rows.push(row);
                    }
                    
                    // Supabase'e yükle
                    const { data, error } = await supabase
                        .from(tablo)
                        .insert(rows);
                    
                    if(error) throw error;
                    
                    durumDiv.innerHTML = `Başarılı! ${rows.length} kayıt eklendi.`;
                    fileInput.value = '';
                    
                    // İlgili tablodaki verileri yenile
                    if(tablo === 'okullar') okullariGetir();
                    if(tablo === 'ogretmenler') ogretmenleriGetir();
                    if(tablo === 'ogrenciler') ogrencileriGetir();
                    
                } catch (error) {
                    durumDiv.innerHTML = `Hata: ${error.message}`;
                }
            };
            
            reader.readAsText(file);
        }
        
        // Sayfa yüklendiğinde okulları getir
        document.addEventListener('DOMContentLoaded', okullariGetir);
    </script>
</body>
</html>
